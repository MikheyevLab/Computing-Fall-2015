---
layout: post
title: 9. Bash II (scripting & ssh)
categories: []
tags:
  - news
published: true
---

# Bash scripting
Besides being the environment you can access through a terminal on Linux, the bash is also a programming language.
For certain tasks like repeating commands or running a series of programs it can be quite handy to write scripts in bash.

## Variables

```bash
MY_VAR=10
echo $MY_VAR
echo ${MY_VAR}
echo "${MY_VAR}"
```

The second and third variant are prefered over the first variant.

### Parameter expansion
Tons ans tons of different options, that all allow you to do something with a variable before it is used in a context.

```bash
FILE="myfile.csv"
echo ${FILE%%.*}
echo ${FILE#*.}
```

https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html

### Command substitution

```bash
HOST=$(hostname)
LONGINPUT="$(timedatectl)"
```

see http://www.gnu.org/software/bash/manual/bashref.html#Command-Substitution

## Arrays

Arrays in bash can get a bit messy, but it boils down to

```bash
declare -a my_array
my_array[0] = "Hey!"
my_array = ("Ho!" "What?!")

echo ${my_array[1]}
echo ${my_array[@]}
echo ${#my_array}
```

There are also associative arrays (dictionaries) in bash.

http://www.thegeekstuff.com/2010/06/bash-array-tutorial/ and http://www.gnu.org/software/bash/manual/html_node/Arrays.html

## Loops and control structure

```bash
# Looping through arrays
declare -a files = ("1.csv" "2.csv" "3.csv")
for f in ${files[@]}; do
   cp ${f} "${f%%.*}.tsv"
end

for i in `seq 1 10`; do
  echo $i
end

for i in $( ls ); do
  echo item: $i
done

# ifs

if [ "foo" = "foo" ]; then
  echo expression evaluated as true
else
  echo expression evaluated as false
fi

for f in $( ls ); do
  if [ -d ${f} ]; then
    echo "Found directory ${f}"
  fi
done
```

In the last example I am using a conditional expression. In bash there are several special conditionals that you can use: http://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html

# SSH
To securely login to remote systems use the ssh command.

```bash
ssh [-p port] [user@]hostname [command]
```

The default values for port is 22 and for user it is `$(whoami)`. If a command is present that will be executed and the session terminated afterwards.

## SSH keys
In order that you don't have to enter your password every time you login to a server or copy a file to and from it, I would recommend creating a private-public key and copying the public part to the server.

```bash
EMAIL="your_email@example.com"
USER="user-name"

if [ ! -f "~/.ssh/id_rsa.pub" ]; do
  ssh-keygen -t rsa -b 4096 -C "${EMAIL}"
fi

# ssh-copy-id does not exist on macs
ssh-copy-id ${USER}@login.oist.jp

# on a mac use this
# cat ~/.ssh/id_rsa.pub | ssh user@machine "mkdir -p ~/.ssh; cat >> ~/.ssh/authorized_keys"
```

## SSH config

The configuration file for ssh in `~/.ssh/config` allows you to set default configurations and aliases.

```
Host sango
   HostName sango.oist.jp
   User user-name
```

`ssh sango`

## scp & rsync
`scp` and `rsync` are tools to copy files from and to remote hosts.

```bash
# From
scp host:path/to/file local/target
scp local/file host:remote/target
```

`rsync` is a bit more powerful, because it allows use to resume transfers when we lose connection and the basic syntax is the same like `scp`.

See https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories-on-a-vps

# Homework
The homework is due on *October 22 2015* at *13:00pm* (eg. noon).

